"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_wtcControllerElement=require("wtc-controller-element"),_wtcControllerElement2=_interopRequireDefault(_wtcControllerElement),_wtcControllerViewports=require("wtc-controller-viewports"),_wtcControllerViewports2=_interopRequireDefault(_wtcControllerViewports);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var AutoplayVideo=function(_Viewport){function AutoplayVideo(element,options){_classCallCheck(this,AutoplayVideo);var _this=_possibleConstructorReturn(this,(AutoplayVideo.__proto__||Object.getPrototypeOf(AutoplayVideo)).call(this,element));return options=Object.assign({},{fullWidth:!1,vpOn:0},options),_this.hasStarted=!1,_this.initiated=!1,_this.options={fullWidth:_this.element.classList.contains("autoplay-video--fullscreen")||options.fullWidth,vpOn:_this.element.hasAttribute("data-vp-on")?parseInt(_this.element.getAttribute("data-vp-on")):options.vpOn},_this.options.fullWidth&&!_this.element.classList.contains("autoplay-video--fullscreen")&&_this.element.classList.add("autoplay-video--fullscreen"),_this._video=_this.element.querySelector(".autoplay-video__video"),_this._fallback=_this.element.querySelector(".autoplay-video__fallback"),_this._video.muted=!0,_this._video.setAttribute("playsinline",""),_this._video.setAttribute("muted",""),navigator&&navigator.connection?(console.log(1),navigator.connection.saveData?(console.log(2),_this.onFrozen(_this)):(console.log(3),_this._video.addEventListener("canplay",_this.init.bind(_this),!1))):2<=_this._video.readyState?(console.log(4),_this.init()):(console.log(5),_this._video.addEventListener("canplay",_this.init.bind(_this),!1)),_this._video.addEventListener("error",_this.onFrozen.bind(_this),!0),_this}return _inherits(AutoplayVideo,_wtcControllerViewports.Viewport),_createClass(AutoplayVideo,[{key:"init",value:function(){var _this2=this;if(!this.initiated){if(this.initiated=!0,this.ratio=this._video.videoWidth/this._video.videoHeight,this.options.fullWidth){var resizeTimer=null,resizeDebounce=function(){clearTimeout(resizeTimer),resizeTimer=setTimeout(function(){_this2.videoResize()},300)};resizeDebounce(),window.addEventListener("resize",resizeDebounce)}this._video.hasAttribute("autoplay")&&this.playVideo()}}},{key:"videoResize",value:function(){var targetW=this._video.parentNode.offsetWidth,targetH=this._video.parentNode.offsetHeight,newW=0,newH=0;targetW/targetH>this.ratio?newH=(newW=targetW)*this.ratio:newW=(newH=targetH)*this.ratio,this._video.style.height=newH+"px",this._video.style.width=newW+"px"}},{key:"onPlay",value:function(){this.element.classList.add("is-playing"),this.hasStarted=!0}},{key:"onFrozen",value:function(){console.log(3,"frozen"),this.element.classList.add("is-frozen")}},{key:"onPause",value:function(){this.element.classList.add("is-paused"),this.hasStarted=!1}},{key:"pauseVideo",value:function(){this._video.pause(),this.onPause()}},{key:"playVideo",value:function(){if(2<=this._video.readyState)if(this._video.paused){var testPlay=this._video.play();try{"undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]")&&testPlay&&testPlay instanceof Promise?testPlay.then(this.onPlay.bind(this),this.onFrozen.bind(this)):this._video.paused?this.onFrozen():this.onPlay()}catch(error){this.onFrozen()}}else this.onPlay();else setTimeout(this.playVideo.bind(this),500)}},{key:"runAnimation",value:function(topPercent){topPercent>this.options.vpOn&&this.initiated&&(this.hasStarted||this.playVideo())}},{key:"video",get:function(){return this._video}}]),AutoplayVideo}();_wtcControllerElement.ExecuteControllers.registerController(AutoplayVideo,"AutoplayVideo"),exports.default=AutoplayVideo;